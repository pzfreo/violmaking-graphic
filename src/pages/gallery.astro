---
import BaseLayout from '../layouts/BaseLayout.astro';
import Hero from '../components/Hero.astro';

const images = [
  { src: '/images/instruments/carlos-pineda-1.jpeg', alt: 'Carlos Pineda', maker: 'Carlos Pineda' },
  { src: '/images/instruments/carlos-pineda-2.jpeg', alt: 'Carlos Pineda', maker: 'Carlos Pineda' },
  { src: '/images/instruments/carlos-pineda-3.jpeg', alt: 'Carlos Pineda', maker: 'Carlos Pineda' },
  { src: '/images/instruments/carlos-pineda-4.jpeg', alt: 'Carlos Pineda', maker: 'Carlos Pineda' },
  { src: '/images/instruments/carlos-pineda-5.jpeg', alt: 'Carlos Pineda', maker: 'Carlos Pineda' },
  { src: '/images/instruments/ercole-dervic-1.jpg', alt: 'Ercole e Dervic', maker: 'Ercole e Dervic' },
  { src: '/images/instruments/ercole-dervic-2.jpg', alt: 'Ercole e Dervic', maker: 'Ercole e Dervic' },
  { src: '/images/instruments/ercole-dervic-3.jpg', alt: 'Ercole e Dervic', maker: 'Ercole e Dervic' },
  { src: '/images/instruments/ercole-dervic-4.jpg', alt: 'Ercole e Dervic', maker: 'Ercole e Dervic' },
  { src: '/images/instruments/ercole-dervic-5.jpg', alt: 'Ercole e Dervic', maker: 'Ercole e Dervic' },
  { src: '/images/instruments/ercole-dervic-6.jpg', alt: 'Ercole e Dervic', maker: 'Ercole e Dervic' },
  { src: '/images/instruments/johnnie-hill-1.jpeg', alt: 'Johnnie Hill', maker: 'Johnnie Hill' },
  { src: '/images/instruments/johnnie-hill-2.jpeg', alt: 'Johnnie Hill', maker: 'Johnnie Hill' },
  { src: '/images/instruments/johnnie-hill-3.jpeg', alt: 'Johnnie Hill', maker: 'Johnnie Hill' },
  { src: '/images/instruments/johnnie-hill-4.jpeg', alt: 'Johnnie Hill', maker: 'Johnnie Hill' },
  { src: '/images/instruments/johnnie-hill-5.jpeg', alt: 'Johnnie Hill', maker: 'Johnnie Hill' },
];

const makers = [...new Set(images.map(img => img.maker))];
---

<BaseLayout
  title="Gallery"
  description="Gallery of instruments and photos from the Viol Making Symposium"
>
  <Hero
    title="Gallery"
    subtitle="Instruments and makers"
  />

  <section class="py-16">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
      <p class="text-text-light text-center mb-8 max-w-2xl mx-auto">
        A collection of instruments from our speakers. Click any image to view in full size.
      </p>

      <!-- Filter buttons -->
      <div class="flex flex-wrap justify-center gap-3 mb-12">
        <button
          class="filter-btn px-4 py-2 rounded-lg font-medium transition-colors bg-primary text-white"
          data-maker="all"
        >
          All
        </button>
        {makers.map((maker) => (
          <button
            class="filter-btn px-4 py-2 rounded-lg font-medium transition-colors bg-bg-alt text-text-light hover:bg-border"
            data-maker={maker}
          >
            {maker}
          </button>
        ))}
      </div>

      <!-- Gallery grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="gallery-grid">
        {images.map((image) => (
          <a
            href={image.src}
            class="glightbox gallery-item group block overflow-hidden rounded-lg bg-bg-alt"
            data-gallery="gallery"
            data-glightbox={`title: ${image.maker}`}
            data-maker={image.maker}
          >
            <div class="aspect-square overflow-hidden">
              <img
                src={image.src}
                alt={image.alt}
                loading="lazy"
                class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"
              />
            </div>
            <div class="p-3">
              <p class="text-sm font-medium text-text">{image.maker}</p>
            </div>
          </a>
        ))}
      </div>
    </div>
  </section>
</BaseLayout>

<script>
  import GLightbox from 'glightbox';
  import 'glightbox/dist/css/glightbox.min.css';

  document.addEventListener('DOMContentLoaded', () => {
    // Initialize lightbox
    const lightbox = GLightbox({
      selector: '.glightbox:not(.hidden)',
      touchNavigation: true,
      loop: true,
    });

    // Filter functionality
    const filterBtns = document.querySelectorAll('.filter-btn');
    const galleryItems = document.querySelectorAll('.gallery-item');

    filterBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        const maker = btn.getAttribute('data-maker');

        // Update button styles
        filterBtns.forEach(b => {
          b.classList.remove('bg-primary', 'text-white');
          b.classList.add('bg-bg-alt', 'text-text-light');
        });
        btn.classList.remove('bg-bg-alt', 'text-text-light');
        btn.classList.add('bg-primary', 'text-white');

        // Filter images
        galleryItems.forEach(item => {
          const itemMaker = item.getAttribute('data-maker');
          if (maker === 'all' || itemMaker === maker) {
            item.classList.remove('hidden');
          } else {
            item.classList.add('hidden');
          }
        });

        // Reinitialize lightbox with visible items
        lightbox.destroy();
        GLightbox({
          selector: '.glightbox:not(.hidden)',
          touchNavigation: true,
          loop: true,
        });
      });
    });
  });
</script>

<style>
  .hidden {
    display: none;
  }
</style>
